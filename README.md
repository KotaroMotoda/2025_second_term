# 2025年度前期 - こんちゃテスト

## 1. ソフトウェアの並列性

### 逐次プログラム
- **単位**: プログラム全体

### 並列プログラム

#### タスク並列 `[単位: タスク/プロセス]`
複数の独立したタスク（プロセスやスレッド）を同時に実行する方式。各タスクは異なる処理内容を持つことが多く、ワークフローや分散処理などで利用される。

**例**: Webサーバのリクエスト処理、分散シミュレーション

#### スレッド並列 `[単位: スレッド]`
一つのプログラム内で複数のスレッドが同時に動作し、同じ処理や異なる処理を分担して実行する方式。主に共有メモリ上で動作し、マルチコアCPUでの高速化に利用される。

**例**: マルチスレッドプログラム、並列ソート

#### データ並列 `[単位: データ要素]`
同じ処理を大量のデータ要素に対して同時に適用する方式。ベクトル演算や画像処理、科学技術計算などでよく使われる。

**例**: 行列演算、GPUによる画像フィルタ処理

---

## 2. プログラミングモデル・分類軸

### Flynnの分類 `[単位: 命令流/データ流]`
- **SISD**: 単一命令、単一データ
- **SIMD**: 単一命令、複数データ
- **MISD**: 複数命令、単一データ
- **MIMD**: 複数命令、複数データ

### その他の分類
- **SPMD/MPMD**: 単一/複数プログラム
- **メッセージパッシング** `[単位: プロセス間通信]`: 共有メモリに代わり,*各プロセッサが固有のアドレス空間を持つシステムが必要*となった時に,ネットワークを介してメッセージを交換(メッセージパッシング)を用いればそれが実装できるじゃんということで実装された. 課題は以下の3つである.
  - ***ハードウェア*** : ネットワークが大事なので,ここにコストかかる.
  - ***ソフトウェア*** : 明示的に情報交換を記述する必要がある.既存のappを,メッセージパッシング方式に変更する時に莫大なコストがかかる.
  - ***性能の見積もり,チューニングの課題***

---
## 3. ハードウェア並列性

### 並列性の分類軸

#### 空間的並列（Spatial Parallelism）
複数のリソースを同時に使う並列性（物理的な同時実行）

- **マルチコア**: 複数コアで同時に命令を実行
- **SIMDプロセッサ**: 単一命令で複数データを同時処理
- **ベクトルプロセッサ**: ベクトル命令で長いデータ列を同時処理
- **GPU**: 多数の演算ユニットでデータ並列処理
- **SMT（同時マルチスレッド）**: 1コア内の複数スレッドが同時に命令を発行
- **SMP/NUMA**: 複数プロセッサ/ノードによる並列
- **クラスタ/グリッド**: 複数ノード/マシンによる分散並列
- **ドメイン固有アーキテクチャ**: 汎用性はすて,狭い範囲のタスクしか行わないが,極めて優れた結果を示す.プロセッサが二つあり,片方が,OSのような従来の大型プログラムを実行するプロセッサであり,もう一方が,ドメイン固有のプロセッサ.また,コンパイラや開発者そっちのけでドメイン内の特定の機能専用に特性されたソフトウェアの制御メモリによってデータ移送が削減される.

#### 時間的並列（Temporal Parallelism）
1つのリソースを時間で分割して複数処理

- **粗粒度マルチスレッド**: 長い待ち時間ごとにスレッド切替
- **細粒度マルチスレッド**: 命令ごとにスレッド切替
- **パイプライン**: 命令を段階的に重ねて実行

### 命令レベル並列（ILP） `[単位: 命令]`
- **スーパースカラ**: 複数命令を同時発行
- **VLIW**: 複数命令を1命令語で同時実行

### データレベル並列（DLP） `[単位: データ要素]`

#### スカラアーキテクチャ
1命令1データ。逐次実行が基本で、各命令ごとにデータハザード（依存関係）の確認が毎回必要。メモリアクセスのレイテンシ（待ち時間）の影響を受けやすい。

#### SIMDアーキテクチャ
1命令複数データ。for文の処理など、データレベル並列性を持つデータを処理する時に、最も高い性能を発揮する。

#### ベクトルアーキテクチャ
ベクトル命令で複数データをまとめて処理。データハザードの確認はベクトル単位で効率的に行われるため、スカラ型よりもオーバーヘッドが小さい。メモリアクセスも連続アクセスが多く、レイテンシ隠蔽が可能。

#### GPUアーキテクチャ
大量データ並列処理に特化

### プロセッサレベル `[単位: コア/ノード]`
- **マルチコア**
- **SMP/NUMA**
- **クラスタ（疎結合）** : メッセージパッシング方式の並列システム. 独立したコンピュータを複数台ネットに接続してOSを起動.並列プログラム実行環境を用いてコンピュータを並列システムにしている.特徴として,*いづれかのコンピュータが落ちても動き続ける.*
- **グリッドコンピューティング** : PCを*広域に分散*し,インターネットを通じて情報交換.

---
## 4. メモリ構造

### メモリアーキテクチャの分類
- **メモリ階層化** `[単位: メモリレベル]`
- **共有/プライベートメモリ** `[単位: アドレス空間]`

---

## 5. 相互接続ネットワーク

### ネットワーク構成要素
- **ノード/リンク/トポロジ** `[単位: ノード間接続]`

> **トポロジとは**: ノード同士の接続形態。バス、リング、メッシュ、ツリー、N-キューブ（ハイパーキューブ）、全結合、マルチステージ（クロスバ、バタフライなど）などがある。それぞれ通信遅延や拡張性、コストに特徴がある。

### 主要なトポロジタイプ
- **種類**
  - **バス** 
    - 誰かがバスを利用すると他のノードは待たされる.
    - 隣同士と端同士ではかかる時間が異なるかも.
  - **リング**
    - 同時に複数の通信が可能.
  - **全結合網**
    - 全てのコンピュータが1対1でつながる.
    - コスト高い
- **性能評価**
  - **メッセージあたりのレイテンシ(遅延)**
  - **スループット(バンド幅)**

---

## 6. ベンチマーク・性能指標

### 測定対象
- **プログラム/アプリ/システム** `[単位: 測定対象全体]`

### 主要なベンチマーク
- **Linpack**
- **SPEC**

- **ルーフライン（Roofline）モデル**

#### ルーフラインモデルとは
ルーフラインモデルは、計算機システムの性能上限（スループット）を「計算性能」と「メモリ帯域」の2つの観点から可視化するためのグラフモデルです。主にHPC（高性能計算）分野で、アプリケーションやアルゴリズムのボトルネック分析や最適化指針として利用されます。

#### 基本構造
- **横軸**：演算強度（Operational Intensity, OI）
  - 1バイトのデータ転送あたりに実行される浮動小数点演算数（FLOP/Byte）
- **縦軸**：実効性能（FLOPS, 浮動小数点演算/秒）

グラフ上には2つの「天井（Roof）」が描かれます：
1. **メモリ帯域の天井**（斜めの直線）
   - メモリ帯域幅 × OI で決まる。演算強度が低い領域では、性能はメモリ帯域によって制限される。
2. **計算性能の天井**（水平線）
   - プロセッサの理論最大FLOPS。演算強度が高い領域では、性能は計算能力によって制限される。

#### 使い方・読み方
- アプリケーションやカーネルの演算強度を横軸にプロットし、実測性能を縦軸に点で示す。
- 点がどちらの天井に近いかで、ボトルネック（メモリか計算か）が分かる。
- 例えば、点が斜め線（メモリ帯域天井）に近ければ「メモリボトルネック」、水平線（計算天井）に近ければ「計算ボトルネック」。

#### ルーフラインモデルの意義
- **最適化指針**：どちらの天井に近づけるかで、最適化の方向性（メモリアクセスの削減 or 演算効率の向上）が明確になる。

#### 参考図（イメージ）
```text
  ^
  |         ──────────────── 計算性能の天井（水平線）
  |        /
  |       /
  |      /
  |     /
  |    /
  |   /
  |  /
  | /  ← メモリ帯域の天井（斜め線）
  +----------------------------->
    ↑
    演算強度（FLOP/Byte）
```
## 用語解説

### マルチスレッド
複数のスレッド（実行の流れ）を切り替えたり同時に実行したりできる仕組み全般を指す。ソフトウェア（OSやランタイムによるスレッド切替）とハードウェア（CPUによる同時/高速切替）の両方を含む。

ハードウェア的マルチスレッドには以下が含まれる：
- **SMT（同時マルチスレッディング）**
- **粗粒度マルチスレッド**
- **細粒度マルチスレッド**